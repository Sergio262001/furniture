<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accents & Decor</title>

  <!-- ‚úÖ Rutas relativas sin <base> -->
  <link rel="stylesheet" href="../../style.css" />
  <script type="module" src="../../js/firebase.js" defer></script>
</head>
<body>

  <!-- Reutilizable: Header global Furniture -->
<div id="site-header"></div>

<!-- Aseg√∫rate de cargar firebase.js ANTES del header -->
<script type="module" src="../../js/firebase.js"></script>
<script type="module" src="../../js/site-header.js"></script>

  <!-- üîπ Top bar -->
  <div class="top-bar">
    <div>üìç Furniture store in Fairfield, OH | üöö Delivering to <strong>0000</strong></div>
    <div>
      <a href="../../login.html" data-login-link>Login</a>
      <a href="#" data-logout-link style="display:none" onclick="FB.logout()">Logout</a>
      <a href="#" id="financing-btn">Financing</a>
      <a href="#" id="help-btn">Help</a>
      <a href="../../cart.html">üõí (<span id="cart-count">0</span>)</a>
      <span data-user-badge style="margin-left:8px;opacity:.8">Invitado</span>
    </div>
  </div>

  <!-- üîπ Header -->
  <div class="header">
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search decor..." />
    </div>
    <div class="logo">
      <a href="../../index.html"><img src="../../logo.jfif" alt="Logo" /></a>
    </div>
    <div>üìû Shop by phone 000-000-0000</div>
  </div>

  <!-- üîπ Nav -->
  <div class="nav">
    <a href="../livingroom/livingroom.html">LIVING ROOM</a>
    <a href="../bedroom/bedroom.html">BEDROOM</a>
    <a href="../dining/dining.html">DINING</a>
    <a href="../mattresses/mattresses.html">MATTRESSES</a>
    <a href="../outdoor/outdoor.html">OUTDOOR</a>
    <a href="../kids/kids.html">BABY & KIDS</a>
    <a href="../rugs/rugs.html">RUGS</a>
    <a class="active" href="../accents/accents.html">ACCENTS & DECOR</a>
  </div>

  <!-- üîπ Contenido principal -->
  <div class="content">
    <button id="filter-toggle" class="filter-toggle" onclick="toggleFilters()">‚ò∞ Filters</button>

    <aside id="filters" class="filters">
      <div class="filters-header">
        <button class="filters-close-btn" type="button" aria-label="Close">‚úï</button>
      </div>

      <h3>Filters</h3>

      <label>Min Price:</label>
      <input type="number" id="minPriceFilter" placeholder="e.g. 100">

      <label>Max Price:</label>
      <input type="number" id="maxPriceFilter" placeholder="e.g. 2000">

      <label for="typeFilter">Type:</label>
      <select id="typeFilter">
        <option value="">All</option>
        <option value="mirror">Mirror</option>
        <option value="lamp">Lamp</option>
        <option value="pillow">Pillow</option>
        <option value="wallart">Wall Art</option>
        <option value="clock">Clock</option>
        <option value="vase">Vase</option>
      </select>

      <label for="materialFilter">Material:</label>
      <select id="materialFilter">
        <option value="">All</option>
        <option value="wood">Wood</option>
        <option value="metal">Metal</option>
        <option value="ceramic">Ceramic</option>
        <option value="glass">Glass</option>
        <option value="fabric">Fabric</option>
      </select>

      <label for="colorFilter">Color:</label>
      <select id="colorFilter">
        <option value="">All</option>
        <option value="neutral">Neutral</option>
        <option value="multicolor">Multicolor</option>
        <option value="gold">Gold</option>
        <option value="silver">Silver</option>
        <option value="black">Black</option>
        <option value="white">White</option>
      </select>

      <label for="styleFilter">Style:</label>
      <select id="styleFilter">
        <option value="">All</option>
        <option value="modern">Modern</option>
        <option value="traditional">Traditional</option>
        <option value="bohemian">Bohemian</option>
        <option value="industrial">Industrial</option>
        <option value="minimalist">Minimalist</option>
      </select>

      <button onclick="applyFilters()">Apply Filters</button>
    </aside>

    <div class="products" id="products"></div>
  </div>

  <div class="chat">üí¨ Chat With Us</div>

  <!-- üîπ Script principal -->
  <script>
    // ===== Cargar data =====
    fetch('./accents.json')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("products");

        function cardHref(prod) {
          // ‚úÖ Detalle consistente
          return '../../producto.html?id=' + encodeURIComponent(prod.id) + '&cat=accents';
        }

        function renderProducts(list) {
          container.innerHTML = "";
          list.forEach(prod => {
            const href = cardHref(prod);
            container.innerHTML += `
              <div class="product-card">
                <a href="${href}">
                  <img src="${(prod.images && prod.images[0]) || ''}" alt="${prod.name || ''}">
                  <h3>${prod.name || ''}</h3>
                  <p>$${Number(prod.price || 0).toFixed(2)}</p>
                </a>
                <button class="buy-btn"
                  onclick="addToCart('${String(prod.id)}', '${(prod.name || '').replace(/'/g, "\\'")}', ${Number(prod.price || 0)}, '${((prod.images && prod.images[0]) || '').replace(/'/g, "\\'")}')">
                  üõí Buy
                </button>
              </div>
            `;
          });
        }

        renderProducts(data);

        // ===== B√∫squeda =====
        document.getElementById("searchInput").addEventListener("input", e => {
          const text = (e.target.value || "").toLowerCase();
          if (!text) return renderProducts(data);
          const filtered = data.filter(p =>
            (p.name && p.name.toLowerCase().includes(text)) ||
            (p.description && p.description.toLowerCase().includes(text))
          );
          renderProducts(filtered);
        });

        // ===== Filtros =====
        window.toggleFilters = () => {
          document.getElementById("filters").classList.toggle("open");
        };

        window.applyFilters = () => {
          const min = parseFloat(document.getElementById("minPriceFilter").value) || 0;
          const max = parseFloat(document.getElementById("maxPriceFilter").value) || Infinity;
          const type = document.getElementById("typeFilter").value.toLowerCase();
          const material = document.getElementById("materialFilter").value.toLowerCase();
          const color = document.getElementById("colorFilter").value.toLowerCase();
          const style = document.getElementById("styleFilter").value.toLowerCase();

          const filtered = data.filter(p =>
            Number(p.price || 0) >= min &&
            Number(p.price || 0) <= max &&
            (type === "" || (p.type && p.type.toLowerCase() === type)) &&
            (material === "" || (p.material && p.material.toLowerCase() === material)) &&
            (color === "" || (p.color && p.color.toLowerCase() === color)) &&
            (style === "" || (p.style && p.style.toLowerCase() === style))
          );
          renderProducts(filtered);
        };
      });

    // ===== Carrito =====
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function lsSet(items) {
      localStorage.setItem("cart", JSON.stringify(items));
      updateCartCount();
    }

    function updateCartCount() {
      const count = (cart || []).reduce((s, i) => s + Number(i.quantity || 0), 0);
      const el = document.getElementById("cart-count");
      if (el) el.textContent = count;
    }

    async function addToCart(id, name, price, image) {
      const item = { id, name, price: Number(price || 0), image: image || "", quantity: 1 };
      const useFirebase = window.FB && FB.auth && FB.auth.currentUser && typeof FB.addToCart === "function";
      try {
        if (useFirebase) await FB.addToCart(item);
        else {
          const found = cart.find(p => String(p.id) === String(id));
          if (found) found.quantity = Number(found.quantity || 0) + 1;
          else cart.push(item);
          lsSet(cart);
        }
        if (!useFirebase) updateCartCount();
        alert(name + " added ‚úÖ");
      } catch (e) {
        console.error(e);
        alert("Could not add to cart: " + (e.message || e));
      }
    }

    window.onload = updateCartCount;
    window.addEventListener("storage", e => {
      if (e.key === "cart") {
        cart = JSON.parse(localStorage.getItem("cart")) || [];
        updateCartCount();
      }
    });
  </script>

  <!-- üîπ Scripts globales -->
  <script src="../../js/modals.js" defer></script>
  <script src="../../js/chat-widget.js" defer></script>

   <!-- ... contenido de la p√°gina ... -->

  <!-- Firebase base -->
  <script type="module" src="../../js/firebase.js"></script> <!-- ... contenido de la p√°gina ... -->

  <!-- Firebase base -->
  <script type="module" src="../../js/firebase.js"></script>
  <!-- ... resto de tu contenido -->

  <!-- Firebase base -->
  <script type="module" src="../../js/firebase.js"></script>

  <!-- Script del men√∫ desplegable de usuario -->
  <script type="module">
    import { onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    const { auth } = window.FB;

    const loginLink  = document.querySelector('[data-login-link]');
    const badge      = document.querySelector('[data-user-badge]');
    const menuWrap   = document.getElementById('user-menu-container');
    const btn        = document.getElementById('user-menu-button');
    const dropdown   = document.getElementById('user-dropdown');
    const nameTop    = document.getElementById('user-name');
    const avatarTop  = document.getElementById('user-avatar');
    const nameDrop   = document.getElementById('dropdown-name');
    const emailDrop  = document.getElementById('dropdown-email');
    const avatarDrop = document.getElementById('dropdown-avatar');
    const resetLi    = document.getElementById('reset-link');
    const logoutA    = document.getElementById('logout-link');

    // Toggle dropdown
    btn?.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', () => dropdown.style.display = 'none');

    // Pinta datos y controla visibilidad login/men√∫
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const name  = user.displayName || 'Mi cuenta';
        const email = user.email || '';
        const photo = user.photoURL || 'img/avatar-default.png';

        if (badge) badge.textContent = name;
        if (loginLink) loginLink.style.display = 'none';
        menuWrap.style.display = 'inline-block';

        nameTop.textContent = name.split(' ')[0];
        avatarTop.src = photo;
        nameDrop.textContent = name;
        emailDrop.textContent = email;
        avatarDrop.src = photo;

        const providerId = (user.providerData[0]?.providerId) || 'password';
        resetLi.style.display = providerId === 'password' ? '' : 'none';
      } else {
        if (badge) badge.textContent = 'Invitado';
        if (loginLink) loginLink.style.display = '';
        menuWrap.style.display = 'none';
        dropdown.style.display = 'none';
      }
    });

    // Logout
    logoutA?.addEventListener('click', async (e) => {
      e.preventDefault();
      await window.FB.logout();
      location.href = 'index.html';
    });

    // Reset password
    resetLi?.addEventListener('click', async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (user?.email) {
        await sendPasswordResetEmail(auth, user.email);
        alert('Te enviamos un correo para cambiar la contrase√±a.');
      }
    });
  </script>
  <script src="../../js/filters-wire.js"></script>


<!-- UX filtros: overlay, ESC, cerrar al aplicar (paridad con Outdoor) -->
<script>
(function () {
  var panel = document.getElementById('filters');
  if (!panel || panel.__wired) return; // evita doble cableado si ya existe
  panel.__wired = true;

  // 1) Overlay hermano inmediato de #filters
  var overlay = panel.nextElementSibling;
  if (!(overlay && overlay.classList.contains('filters-overlay'))) {
    document.querySelectorAll('.filters-overlay').forEach(function(el){ if (el !== overlay) el.remove(); });
    overlay = document.createElement('div');
    overlay.className = 'filters-overlay';
    panel.parentNode.insertBefore(overlay, panel.nextElementSibling);
  }

  // 2) Asegura header con bot√≥n ‚úï si falta
  if (!panel.querySelector('.filters-header')) {
    var header = document.createElement('div');
    header.className = 'filters-header';
    header.innerHTML = '<strong>Filters</strong><button class="filters-close-btn" type="button" aria-label="Close">‚úï</button>';
    panel.insertBefore(header, panel.firstChild);
  }
  var closeBtn = panel.querySelector('.filters-close-btn');

  // 3) Sincroniza estado visual + bloqueo de scroll
  function sync() {
    var open = panel.classList.contains('open');
    document.body.classList.toggle('body-no-scroll', open);
    overlay.style.display = open ? 'block' : 'none';
    if (open && window.matchMedia('(max-width:768px)').matches) panel.style.left = '0';
    if (!open && panel.style.left === '0px') panel.style.left = '';
  }

  // 4) Reemplaza/decora toggleFilters para mantener compatibilidad
  var originalToggle = window.toggleFilters;
  window.toggleFilters = function () {
    if (typeof originalToggle === 'function') originalToggle();
    else panel.classList.toggle('open');
    sync();
  };

  // 5) Cerrar por ‚úï, overlay y tecla ESC
  if (closeBtn) closeBtn.addEventListener('click', function(){ panel.classList.remove('open'); sync(); });
  overlay.addEventListener('click', function(){ panel.classList.remove('open'); sync(); });
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && panel.classList.contains('open')) { panel.classList.remove('open'); sync(); }
  });

  // 6) Cerrar al aplicar (sin romper onclick existente)
  var applyBtn = panel.querySelector("button[onclick*='applyFilters']");
  if (applyBtn && !applyBtn.__closeWired) {
    applyBtn.addEventListener('click', function(){ setTimeout(function(){ panel.classList.remove('open'); sync(); }, 0); });
    applyBtn.__closeWired = true;
  }

  // 7) Exp√≥n applyFilters si no est√° global
  if (typeof window.applyFilters !== 'function' && typeof applyFilters === 'function') {
    window.applyFilters = applyFilters;
  }
})();
</script>

</body>
</html>